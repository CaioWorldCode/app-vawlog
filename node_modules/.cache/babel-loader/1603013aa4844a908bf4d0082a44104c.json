{"ast":null,"code":"import _objectSpread from\"/Users/caio/Projects/Samples/front-vawlog/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/caio/Projects/Samples/front-vawlog/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useMemo,useState,useEffect,useRef}from'react';import classNames from'classnames';import FuzzyHighlighter from'react-fuzzy-highlighter';import{useIntl}from'react-intl';import{useHistory}from'react-router-dom';import{useSelector}from'react-redux';import{getSearchItems}from'routing/helper';import{USE_MULTI_LANGUAGE}from'config.js';import routesAndMenuItems from'routes.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var RESULT_LIMIT=10;var SearchInput=function SearchInput(_ref){var show=_ref.show,setShow=_ref.setShow;var history=useHistory();var searchInput=useRef(null);var _useState=useState(null),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),query=_useState4[0],setQuery=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),selectedIndex=_useState6[0],setSelectedIndex=_useState6[1];var resultCount=React.useRef(0);var selectedItem=React.useRef({});var mySelectedIndexRef=React.useRef(selectedIndex);var setMySelectedIndex=function setMySelectedIndex(currenData){mySelectedIndexRef.current=currenData;setSelectedIndex(currenData);};var _useSelector=useSelector(function(state){return state.auth;}),isLogin=_useSelector.isLogin,currentUser=_useSelector.currentUser;var routes=useMemo(function(){return getSearchItems({data:routesAndMenuItems,isLogin:isLogin,userRole:currentUser.role})();},[isLogin,currentUser]);var _useIntl=useIntl(),f=_useIntl.formatMessage;var onResultClick=function onResultClick(path){if(path){setShow(false);history.push(path);}};var onKeyDown=function onKeyDown(e){if(![38,40,13].includes(e.keyCode)){return;}var rCount=resultCount.current;var sIndex=mySelectedIndexRef.current;if(rCount<=0)return;if(sIndex===null){setMySelectedIndex(0);return;}if(e.keyCode===38){// up\nsetMySelectedIndex(sIndex<=0?rCount-1:sIndex-1);}else if(e.keyCode===40){// down\nsetMySelectedIndex(sIndex>=rCount-1?0:sIndex+1);}else{// enter\nvar sCurrent=selectedItem.current;if(sCurrent){onResultClick(sCurrent.path);}}};useEffect(function(){if(USE_MULTI_LANGUAGE){var formatedRoutes=routes.map(function(d){return _objectSpread(_objectSpread({},d),{},{label:f({id:d.label||'menu.home'})});});setData(formatedRoutes);}else{setData(routes);}document.addEventListener('keydown',onKeyDown);return function(){document.removeEventListener('keydown',onKeyDown);};// eslint-disable-next-line\n},[]);useEffect(function(){if(show){setTimeout(function(){searchInput.current.focus();},0);}else{setQuery('');}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[show]);useEffect(function(){setMySelectedIndex(null);resultCount.current=0;selectedItem.current={};// eslint-disable-next-line\n},[query]);if(data){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{ref:searchInput,id:\"searchPagesInput\",className:\"form-control form-control-xl borderless ps-0 pe-0 mb-1 auto-complete\",type:\"text\",autoComplete:\"off\",onChange:function onChange(e){return setQuery(e.target.value);},value:query,placeholder:\"Pesquisar por p\\xE1ginas\",autoFocus:true}),query.length>0&&/*#__PURE__*/_jsx(FuzzyHighlighter,{query:query,data:data,options:{shouldSort:true,includeMatches:true,threshold:0.6,location:0,distance:100,maxPatternLength:32,minMatchCharLength:1,keys:['label']},children:function children(_ref2){var formattedResults=_ref2.formattedResults,results=_ref2.results;resultCount.current=Math.min(formattedResults.length,RESULT_LIMIT);selectedItem.current=selectedIndex===null?{}:results[selectedIndex].item;return results.length>0?/*#__PURE__*/_jsx(\"ul\",{id:\"searchPagesResults\",className:\"auto-complete-result\",children:formattedResults.slice(0,RESULT_LIMIT).map(function(formattedResult,resultIndex){return/*#__PURE__*/_jsxs(\"li\",{onClick:function onClick(){return onResultClick(formattedResult.item.path);},className:classNames('auto-complete-result-item',{autoComplete_selected:selectedIndex===resultIndex}),children:[Array.isArray(formattedResult.formatted.label)?/*#__PURE__*/_jsx(\"p\",{className:\"mb-0\",children:formattedResult.formatted.label.map(function(t,tIndex){if(t.isHighlighted){return/*#__PURE__*/_jsx(\"span\",{className:\"autoComplete_highlighted\",children:t.text},tIndex);}return/*#__PURE__*/_jsx(\"span\",{children:t.text},tIndex);})}):/*#__PURE__*/_jsx(\"p\",{className:\"mb-0\",children:formattedResult.formatted.label}),/*#__PURE__*/_jsx(\"p\",{className:\"text-small text-muted mb-0 \",children:formattedResult.item.path})]},resultIndex);})}):/*#__PURE__*/_jsx(\"ul\",{id:\"searchPagesResults\",className:\"auto-complete-result\",children:/*#__PURE__*/_jsx(\"li\",{className:\"no_resulst\",children:\"No Results\"})});}})]});}return/*#__PURE__*/_jsx(_Fragment,{});};export default SearchInput;","map":{"version":3,"names":["React","useMemo","useState","useEffect","useRef","classNames","FuzzyHighlighter","useIntl","useHistory","useSelector","getSearchItems","USE_MULTI_LANGUAGE","routesAndMenuItems","RESULT_LIMIT","SearchInput","show","setShow","history","searchInput","data","setData","query","setQuery","selectedIndex","setSelectedIndex","resultCount","selectedItem","mySelectedIndexRef","setMySelectedIndex","currenData","current","state","auth","isLogin","currentUser","routes","userRole","role","f","formatMessage","onResultClick","path","push","onKeyDown","e","includes","keyCode","rCount","sIndex","sCurrent","formatedRoutes","map","d","label","id","document","addEventListener","removeEventListener","setTimeout","focus","target","value","length","shouldSort","includeMatches","threshold","location","distance","maxPatternLength","minMatchCharLength","keys","formattedResults","results","Math","min","item","slice","formattedResult","resultIndex","autoComplete_selected","Array","isArray","formatted","t","tIndex","isHighlighted","text"],"sources":["/Users/caio/Projects/Samples/front-vawlog/src/layout/nav/search/SearchInput.js"],"sourcesContent":["import React, { useMemo, useState, useEffect, useRef } from 'react';\nimport classNames from 'classnames';\nimport FuzzyHighlighter from 'react-fuzzy-highlighter';\nimport { useIntl } from 'react-intl';\nimport { useHistory } from 'react-router-dom';\nimport { useSelector } from 'react-redux';\nimport { getSearchItems } from 'routing/helper';\nimport { USE_MULTI_LANGUAGE } from 'config.js';\nimport routesAndMenuItems from 'routes.js';\n\nconst RESULT_LIMIT = 10;\n\nconst SearchInput = ({ show, setShow }) => {\n  const history = useHistory();\n  const searchInput = useRef(null);\n  const [data, setData] = useState(null);\n  const [query, setQuery] = useState('');\n  const [selectedIndex, setSelectedIndex] = useState(null);\n  const resultCount = React.useRef(0);\n  const selectedItem = React.useRef({});\n  const mySelectedIndexRef = React.useRef(selectedIndex);\n  const setMySelectedIndex = (currenData) => {\n    mySelectedIndexRef.current = currenData;\n    setSelectedIndex(currenData);\n  };\n  const { isLogin, currentUser } = useSelector((state) => state.auth);\n\n  const routes = useMemo(\n    () =>\n      getSearchItems({\n        data: routesAndMenuItems,\n        isLogin,\n        userRole: currentUser.role,\n      })(),\n    [isLogin, currentUser]\n  );\n  const { formatMessage: f } = useIntl();\n\n  const onResultClick = (path) => {\n    if (path) {\n      setShow(false);\n      history.push(path);\n    }\n  };\n\n  const onKeyDown = (e) => {\n    if (![38, 40, 13].includes(e.keyCode)) {\n      return;\n    }\n    const rCount = resultCount.current;\n    const sIndex = mySelectedIndexRef.current;\n    if (rCount <= 0) return;\n\n    if (sIndex === null) {\n      setMySelectedIndex(0);\n      return;\n    }\n\n    if (e.keyCode === 38) {\n      // up\n      setMySelectedIndex(sIndex <= 0 ? rCount - 1 : sIndex - 1);\n    } else if (e.keyCode === 40) {\n      // down\n      setMySelectedIndex(sIndex >= rCount - 1 ? 0 : sIndex + 1);\n    } else {\n      // enter\n      const sCurrent = selectedItem.current;\n      if (sCurrent) {\n        onResultClick(sCurrent.path);\n      }\n    }\n  };\n\n  useEffect(() => {\n    if (USE_MULTI_LANGUAGE) {\n      const formatedRoutes = routes.map((d) => ({\n        ...d,\n        label: f({ id: d.label || 'menu.home' }),\n      }));\n      setData(formatedRoutes);\n    } else {\n      setData(routes);\n    }\n    document.addEventListener('keydown', onKeyDown);\n\n    return () => {\n      document.removeEventListener('keydown', onKeyDown);\n    };\n    // eslint-disable-next-line\n  }, []);\n\n  useEffect(() => {\n    if (show) {\n      setTimeout(() => {\n        searchInput.current.focus();\n      }, 0);\n    } else {\n      setQuery('');\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [show]);\n\n  useEffect(() => {\n    setMySelectedIndex(null);\n    resultCount.current = 0;\n    selectedItem.current = {};\n    // eslint-disable-next-line\n  }, [query]);\n\n  if (data) {\n    return (\n      <>\n        <input\n          ref={searchInput}\n          id=\"searchPagesInput\"\n          className=\"form-control form-control-xl borderless ps-0 pe-0 mb-1 auto-complete\"\n          type=\"text\"\n          autoComplete=\"off\"\n          onChange={(e) => setQuery(e.target.value)}\n          value={query}\n          placeholder=\"Pesquisar por pÃ¡ginas\"\n          autoFocus\n        />\n        {query.length > 0 && (\n          <FuzzyHighlighter\n            query={query}\n            data={data}\n            options={{\n              shouldSort: true,\n              includeMatches: true,\n              threshold: 0.6,\n              location: 0,\n              distance: 100,\n              maxPatternLength: 32,\n              minMatchCharLength: 1,\n              keys: ['label'],\n            }}\n          >\n            {({ formattedResults, results }) => {\n              resultCount.current = Math.min(formattedResults.length, RESULT_LIMIT);\n              selectedItem.current = selectedIndex === null ? {} : results[selectedIndex].item;\n              return results.length > 0 ? (\n                <ul id=\"searchPagesResults\" className=\"auto-complete-result\">\n                  {formattedResults.slice(0, RESULT_LIMIT).map((formattedResult, resultIndex) => (\n                    <li\n                      key={resultIndex}\n                      onClick={() => onResultClick(formattedResult.item.path)}\n                      className={classNames('auto-complete-result-item', {\n                        autoComplete_selected: selectedIndex === resultIndex,\n                      })}\n                    >\n                      {Array.isArray(formattedResult.formatted.label) ? (\n                        <p className=\"mb-0\">\n                          {formattedResult.formatted.label.map((t, tIndex) => {\n                            if (t.isHighlighted) {\n                              return (\n                                <span key={tIndex} className=\"autoComplete_highlighted\">\n                                  {t.text}\n                                </span>\n                              );\n                            }\n                            return <span key={tIndex}>{t.text}</span>;\n                          })}\n                        </p>\n                      ) : (\n                        <p className=\"mb-0\">{formattedResult.formatted.label}</p>\n                      )}\n                      <p className=\"text-small text-muted mb-0 \">{formattedResult.item.path}</p>\n                    </li>\n                  ))}\n                </ul>\n              ) : (\n                <ul id=\"searchPagesResults\" className=\"auto-complete-result\">\n                  <li className=\"no_resulst\">No Results</li>\n                </ul>\n              );\n            }}\n          </FuzzyHighlighter>\n        )}\n      </>\n    );\n  }\n  return <></>;\n};\n\nexport default SearchInput;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}